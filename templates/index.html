<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ æ¥½å¤©ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼ v3.1</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; max-width: 1200px; margin: auto; padding: 25px; background-color: #f8f9fa; color: #212529; }
        .header, .trends-header { text-align: center; padding-bottom: 20px; margin-bottom: 30px; }
        h1 { color: #d62828; margin: 0; font-size: 2.8em; font-weight: 800; }
        h2 { color: #003049; font-size: 2.2em; border-bottom: 3px solid #003049; padding-bottom: 10px;}
        .section-divider { border: 0; height: 2px; background-color: #dee2e6; margin: 60px 0; }
        .card { background-color: #ffffff; padding: 25px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08); margin-bottom: 30px; }
        label { font-size: 1.1em; font-weight: 600; }
        select, input, button { font-size: 1.05em; padding: 12px 18px; border-radius: 12px; border: 1px solid #ced4da; }
        button { background-color: #d62828; color: white; border: none; cursor: pointer; transition: transform 0.2s ease, background-color 0.2s ease; }
        button:hover { background-color: #b21e1e; transform: scale(1.05); }
        .form-container { display: flex; justify-content: center; align-items: center; gap: 20px; }
        table { width: 100%; border-collapse: collapse; border-radius: 20px; overflow: hidden; }
        th, td { padding: 18px 20px; text-align: left; vertical-align: middle; border-bottom: 1px solid #dee2e6; }
        tr:last-child td { border-bottom: none; }
        th { background-color: #f8f9fa; font-weight: 600; }
        .rank-cell, .review-cell { text-align: center; font-weight: 700; font-size: 1.25em; }
        .rank-change span { font-size: 1.4em; font-weight: 700; color: #d62828; background-color: #f8d7da; padding: 4px 10px; border-radius: 8px; }
        .item-name a { text-decoration: none; color: #023e8a; }
        .item-name a:hover { text-decoration: underline; }
        .reason-tag { display: inline-block; padding: 5px 12px; border-radius: 15px; font-size: 0.9em; font-weight: 600; color: #fff; text-align: center; }
        .reason-both { background-color: #e63946; }
        .reason-rank { background-color: #457b9d; }
        .reason-review { background-color: #fca311; }
    </style>
</head>
<body>

    <div class="header"><h1>ğŸš€ æ¥½å¤©ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼</h1><p>{{ today }}</p></div>
    <div class="card"><form class="form-container" method="get"><label for="genre">æ¥½å¤©ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠ:</label><select name="genre" id="genre">{% for name, id in genres.items() %}<option value="{{ name }}" {% if name == selected_genre %}selected{% endif %}>{{ name }}</option>{% endfor %}</select><button type="submit">è³¼è²·ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’åˆ†æ</button></form></div>
    <div class="card"><strong>åˆ†æçŠ¶æ³:</strong> {{ message }}</div>

    {% if items %}
        <table>
            <thead>
                <tr>
                    <th style="width: 12%;">æ³¨ç›®ç†ç”±</th>
                    <th style="width: 7%;">é †ä½</th>
                    <th style="width: 7%;">å‰å›</th>
                    <th style="width: 8%;">å¤‰å‹•</th>
                    <th>å•†å“å</th>
                    <th style="width: 10%;">ãƒ¬ãƒ“ãƒ¥ãƒ¼å¢—</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>
                        {% if 'Wå¢—' in item.ç†ç”± %}
                            <span class="reason-tag reason-both">{{ item.ç†ç”± }}</span>
                        {% elif 'é †ä½' in item.ç†ç”± %}
                            <span class="reason-tag reason-rank">{{ item.ç†ç”± }}</span>
                        {% else %}
                            <span class="reason-tag reason-review">{{ item.ç†ç”± }}</span>
                        {% endif %}
                    </td>
                    <td class="rank-cell">{{ item.é †ä½_today | int }}ä½</td>
                    <td class="rank-cell" style="color:#6c757d;">{% if item.é †ä½_yesterday == 'åœå¤–' %}åœå¤–{% else %}{{ item.é †ä½_yesterday | int }}ä½{% endif %}</td>
                    <td class="rank-change"><span>â†‘{{ item.é †ä½å¤‰å‹• | int }}</span></td>
                    <td class="item-name">
                        <a href="{{ item.itemUrl_today }}" target="_blank" rel="noopener noreferrer">{{ item.å•†å“å_today }}</a>
                        <br><small style="color: #6c757d;">{{ item.åº—èˆ—å_today }}</small>
                    </td>
                    <td class="rank-change"><span>+{{ item.ãƒ¬ãƒ“ãƒ¥ãƒ¼å¢—åŠ æ•° | int }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>ç¾åœ¨ã€è¡¨ç¤ºã§ãã‚‹æ³¨ç›®å•†å“ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endif %}

    <hr class="section-divider"><div class="trends-header"><h2>ğŸ” Google æ¤œç´¢ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</h2></div><div class="card"><div id="trendsForm" class="form-container"><label for="keyword">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›:</label><input type="text" id="keyword" placeholder="ä¾‹: NISA, é›»æ°—è‡ªå‹•è»Š"><button type="submit">æ¤œç´¢ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’åˆ†æ</button></div></div><div class="card" style="display:none;" id="chartContainer"><canvas id="trendsChart"></canvas></div>
    <script>const trendsForm=document.getElementById("trendsForm"),keywordInput=document.getElementById("keyword"),chartContainer=document.getElementById("chartContainer"),ctx=document.getElementById("trendsChart").getContext("2d");let myChart;trendsForm.addEventListener("submit",async e=>{e.preventDefault();const t=keywordInput.value.trim();if(!t)return void alert("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");try{const e=await fetch(`/get_trends?keyword=${encodeURIComponent(t)}`),o=await e.json();if(o.error)return void alert(o.error);myChart&&myChart.destroy(),chartContainer.style.display="block",myChart=new Chart(ctx,{type:"line",data:o,options:{responsive:!0,plugins:{title:{display:!0,text:`ã€Œ${t}ã€ã®éå»90æ—¥é–“ã®æ¤œç´¢ãƒˆãƒ¬ãƒ³ãƒ‰`}},scales:{y:{beginAtZero:!0,suggestedMax:100}}}})}catch(e){console.error("Error fetching trends data:",e),alert("ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}});</script>
</body>
</html>